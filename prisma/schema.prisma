// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id   Int     @id @default(autoincrement()) // DB id value for the table
  role String? // customer or employee or admin?

  // user authentication
  email    String  @unique
  password String?

  // user info
  firstName  String?
  middleName String?
  lastName   String?
  address    String?
  phone      Int?

  // prisma relations; not shown in database
  Customers  Form[]       @relation("Customers")
  Employees  Form[]       @relation("Employees")
  Parameters Parameters[]
  Tanks      Tank[]
}

model Form {
  id       Int      @id @default(autoincrement())
  approved Boolean  @default(false)
  created  DateTime @default(now())
  request  String?

  Customer   User @relation("Customers", fields: [customerId], references: [id])
  customerId Int

  Employee   User @relation("Employees", fields: [employeeId], references: [id])
  employeeId Int

  Parameters   Parameters @relation(fields: [parametersId], references: [id])
  parametersId Int        @unique

  Tank   Tank @relation(fields: [tankId], references: [id])
  tankId Int

  @@index([customerId])
  @@index([employeeId])
  @@index([parametersId])
  @@index([tankId])
}

model Tank {
  id          Int     @id @default(autoincrement())
  description String?
  size        Int? // gallons/liters of water
  type        String? // freshwater, brackish, saltwater, etc

  User   User @relation(fields: [userId], references: [id])
  userId Int

  Form       Form[]
  Parameters Parameters[]
  Pests      Pest[]

  @@index([userId])
}

// update this model with the bunch of different single-tank recording of parameters
// the point of this is to mimic what parameters a tanknician may log on paper 
model Parameters {
  id       Int      @id @default(autoincrement())
  recorded DateTime @default(now())

  // possible parameter types
  nitrates Float?
  nitrites Float?
  oxygen   Float?
  salt     Float?

  Employee   User @relation(fields: [employeeId], references: [id])
  employeeId Int

  Tank   Tank @relation(fields: [tankId], references: [id])
  tankId Int

  // only one set of parameters per-form (one-to-one relationship)
  Form Form?

  @@index([employeeId])
  @@index([tankId])
}

model Pest {
  id          Int     @id @default(autoincrement())
  species     String?
  description String?

  Tank   Tank @relation(fields: [tankId], references: [id])
  tankId Int

  @@index([tankId])
}
